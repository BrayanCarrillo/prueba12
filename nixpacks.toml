[setup]
  packages = [
    "php80.withExtensions (pe: pe.enabled ++ [])",
    "nginx",
    "libmysqlclient",
    "php80Packages.composer",
    "nodejs_18",
    "npm-9_x"
  ]

[install]
  commands = [
    "mkdir -p /var/log/nginx && mkdir -p /var/cache/nginx",
    "composer install --ignore-platform-reqs",
    "npm i"
  ]

[build]
  commands = [
    "npm run build",
    "php artisan migrate --force",
    "php artisan optimize",
    "chmod 777 -R storage/",
    "chmod 777 -R bootstrap/cache",
    "php artisan storage:link"
  ]

[start]
  command = "php artisan serve --host=0.0.0.0 --port=${PORT:-8000}"
